sudo: required
language: bash

services:
  - docker

env:
  global:
    - DOCKER_VERSION=1.11.2-0~trusty
    - QUAY_ORG=geotrellis
    - QUAY_REPO=${TRAVIS_REPO_SLUG##*/}
    - QUAY_TAG=${TRAVIS_TAG:-${TRAVIS_COMMIT:0:7}}

before_install:
  - apt-cache madison docker-engine
  - sudo apt-get -o Dpkg::Options::="--force-confnew" install -y docker-engine=${DOCKER_VERSION}

script:
  - docker build -t quay.io/${QUAY_ORG}/${QUAY_REPO}:${QUAY_TAG} .

after_success:
  - docker login -e . -p "${QUAY_PASSWORD}" -u "${QUAY_USER}" quay.io
    docker push quay.io/${QUAY_ORG}/${QUAY_REPO}:${QUAY_TAG}
    docker tag -f quay.io/${QUAY_ORG}/${QUAY_REPO}:${QUAY_TAG} quay.io/${QUAY_ORG}/${QUAY_REPO}:latest
    docker push quay.io/${QUAY_ORG}/${QUAY_REPO}:latest

notifications:
  slack:
    secure: CrkP/CaKNoVrTtiz+yT9Zd7T4E80kpH/J99/h1/Ae9bAryGsE3cA1VHwQFV8W3+oCaGU5O6hfFG2JeVmn+9n6Pm3Q96+obQbFD6etMbS0fz8vHJhO7GUqXs/vB7KBkE095XJ77ZdoUgpVfDl6XzoMcBUFIlK+rBiSW6P1AJyi8d5D4diNQzQ5mUL6Na3EZfEoS9Nvm6te/kq+a3fZIDdN0Zam9TlLEAJHQ1uD4zwszNl5bA+JaOLBe8d+AWzGrrxxdRv6NDoSS8Lc0UcX0hu8I3kKKNdjfkgVIt38wTTK8G6XavBAhsa3CuGXOs8y+X90HS1zL5bv4C+GJ6clkEu6Bb6AX2VLMsxjTDjeMD7t0yUKf4C5etmTCdTgFHGLd7+qU5dMxHMyKiBH3n3zrS3hpyi1w6DW6Et6X+w0i0sxmloaYzDXT0xFDrXMA3r7Ly43+Q3dI9TdYpOgQ9tULY4pdaqsSszilqtuOQEKf57x/adbOng6Xo+epCFFJljiI1HhwZSineQLtm8OOmAgsq/gMTCvbKUwokPA2755yxQeaaRaDESm72ON4hu+yknbkZoOs6jrFNrsiJPzQMFKkrU3WIfkw/twEn8JE07AUSakhcb31cVtq2vFpLG0dZgR0eE2xL62hJXW/K/B919zYD9YtC0VwSFP90B3Rpk3A9MaHQ=
